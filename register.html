<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SkySail Drones - Register</title>
        <link rel="icon" href="./images/image-removebg-preview 2.png">

        <!-- Fonts - Montserrat -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

        <!-- Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: {
                            sans: ['Montserrat', 'sans-serif'],
                        },
                    }
                }
            }
        </script>
        
        <style>
            body {
                font-family: 'Montserrat', sans-serif;
            }
            .auth-gradient {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .glass-card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
        </style>
    </head>
    <body class="font-sans antialiased">
        <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden" style="background-image: url('./images/Signin.png'); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed;">
            <div class="absolute inset-0 bg-black/20 backdrop-blur-sm"></div>

            <div class="absolute top-6 left-6 z-10">
                <a href="./index.html" class="flex items-center space-x-2 text-white hover:text-white/80 transition">
                    <img src="./images/logolight.png" alt="SkySail Logo" class="h-14 w-auto">
                </a>
            </div>

            <div class="max-w-md w-full relative z-10">
                <div class="bg-white rounded-lg shadow-2xl p-10">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">Create Account</h2>
                        <p class="text-gray-600">Join SkySail and start your drone adventure</p>
                    </div>

                    <form id="registerForm" method="POST" action="#" class="mt-8 space-y-6">
                        <!-- First Name -->
                        <div>
                            <label for="first_name" class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                            <input id="first_name" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500" 
                                 type="text" 
                                 name="first_name" 
                                 required 
                                 autofocus 
                                 autocomplete="given-name"
                                 placeholder="Enter your first name" />
                        </div>

                        <!-- Last Name -->
                        <div>
                            <label for="last_name" class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                            <input id="last_name" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500" 
                                 type="text" 
                                 name="last_name" 
                                 required 
                                 autocomplete="family-name"
                                 placeholder="Enter your last name" />
                        </div>

                        <!-- Email Address -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input id="email" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500" 
                                 type="email" 
                                 name="email" 
                                 required 
                                 autocomplete="username"
                                 placeholder="Enter your email" />
                        </div>

                        <!-- Contact Number -->
                        <div>
                            <label for="contact_number" class="block text-sm font-medium text-gray-700 mb-2">Contact Number</label>
                            <input id="contact_number" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500" 
                                 type="tel" 
                                 name="contact_number" 
                                 required 
                                 autocomplete="tel"
                                 placeholder="Enter your contact number" />
                        </div>

                        <!-- Password -->
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input id="password" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                                 type="password"
                                 name="password"
                                 required 
                                 autocomplete="new-password"
                                 placeholder="Create a password (min 8 characters)" />
                        </div>

                        <!-- Confirm Password -->
                        <div>
                            <label for="password_confirmation" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                            <input id="password_confirmation" 
                                 class="block mt-2 w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                                 type="password"
                                 name="password_confirmation" 
                                 required 
                                 autocomplete="new-password"
                                 placeholder="Confirm your password" />
                        </div>

                        <!-- Status / Error Message -->
                        <div id="registerMessage" class="text-sm text-center text-gray-600"></div>

                        <!-- Submit Button -->
                        <div>
                            <button type="submit" id="submitBtn" class="w-full justify-center bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                                Create Account
                            </button>
                        </div>

                        <!-- Login Link -->
                        <div class="text-center">
                            <p class="text-sm text-gray-600">
                                Already have an account?
                                <a href="./login.html" class="text-purple-600 hover:text-purple-800 font-semibold transition">
                                    Sign in
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            // Hostinger API base and endpoint
            const API_BASE = 'https://skysaildrone.solof.shop';
            const REGISTER_ENDPOINT = API_BASE + '/api-register.php';

            // Handle registration submission via API to Hostinger
            document.getElementById('registerForm').addEventListener('submit', async function (event) {
                event.preventDefault();

                const firstName = document.getElementById('first_name').value.trim();
                const lastName = document.getElementById('last_name').value.trim();
                const email = document.getElementById('email').value.trim();
                const contactNumber = document.getElementById('contact_number').value.trim();
                const password = document.getElementById('password').value;
                const passwordConfirmation = document.getElementById('password_confirmation').value;
                const messageEl = document.getElementById('registerMessage');
                const submitBtn = document.getElementById('submitBtn');

                // Clear previous messages
                messageEl.textContent = '';
                messageEl.classList.remove('text-red-600', 'text-green-600', 'text-gray-600');

                // Validate input
                if (!firstName || !lastName || !email || !contactNumber || !password || !passwordConfirmation) {
                    messageEl.textContent = 'Please fill in all fields.';
                    messageEl.classList.add('text-red-600');
                    return;
                }

                // Validate password match
                if (password !== passwordConfirmation) {
                    messageEl.textContent = 'Password and confirmation do not match.';
                    messageEl.classList.add('text-red-600');
                    return;
                }

                // Validate password length
                if (password.length < 8) {
                    messageEl.textContent = 'Password must be at least 8 characters long.';
                    messageEl.classList.add('text-red-600');
                    return;
                }

                // Show loading state
                submitBtn.textContent = 'Creating Account...';
                submitBtn.disabled = true;
                messageEl.textContent = 'Registering...';
                messageEl.classList.add('text-gray-600');

                try {
                    const response = await fetch(REGISTER_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({
                            first_name: firstName,
                            last_name: lastName,
                            email: email,
                            contact_number: contactNumber,
                            password: password,
                            password_confirmation: passwordConfirmation,
                        }).toString(),
                    });

                    const data = await response.json();
                    console.log('Registration response:', data);

                    if (data.success) {
                        messageEl.textContent = data.message || 'Registration successful! Redirecting to login...';
                        messageEl.classList.remove('text-gray-600', 'text-red-600');
                        messageEl.classList.add('text-green-600');

                        // Store user data in localStorage (optional - for auto-login)
                        if (data.user) {
                            const userToStore = { ...data.user };
                            // Ensure we have both id and id_user for compatibility
                            if (userToStore.id_user && !userToStore.id) {
                                userToStore.id = userToStore.id_user;
                            }
                            if (userToStore.id && !userToStore.id_user) {
                                userToStore.id_user = userToStore.id;
                            }
                            localStorage.setItem('skysail_user', JSON.stringify(userToStore));
                        }

                        // Redirect to login page after successful registration
                        setTimeout(() => {
                            window.location.href = './login.html';
                        }, 1500);
                    } else {
                        messageEl.textContent = data.message || 'Registration failed. Please try again.';
                        messageEl.classList.remove('text-gray-600', 'text-green-600');
                        messageEl.classList.add('text-red-600');
                        submitBtn.textContent = 'Create Account';
                        submitBtn.disabled = false;
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    messageEl.textContent = 'Network error. Please check your connection and try again.';
                    messageEl.classList.remove('text-gray-600', 'text-green-600');
                    messageEl.classList.add('text-red-600');
                    submitBtn.textContent = 'Create Account';
                    submitBtn.disabled = false;
                }
            });
        </script>
    </body>
</html>

